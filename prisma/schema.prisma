generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model User {
  id Int @id @default(autoincrement())
  username String @unique @db.VarChar(20)
  fullname String?
  email String @unique
  verify Boolean @default(false)
  password String

  @@index([email])
  @@index([username])
}

model File {
  id Int @id @default(autoincrement())
  name String
  path String
  mimeType String

  problems Problem[] @relation("ProblemFile")
  contests Contest[] @relation("ContestFile")
}

model Problem {
  id Int @id @default(autoincrement())
  code String @unique @db.VarChar(20)
  name String @db.Char(50)
  input_file String @db.VarChar(20) @default("stdin")
  output_file String @db.VarChar(20) @default("stdout")
  time_limit Int @default(1)
  memory_limit Int @default(256)
  legend String?

  files File[] @relation("ProblemFile")

  @@index([code])
}

model Contest {
  id Int @id @default(autoincrement())
  code String @unique @db.VarChar(20)
  name String @db.Char(50)

  files File[] @relation("ContestFile")
}

model ProblemFile {
  problemId Int
  fileId Int

  @@id([problemId, fileId])
}

model ContestFile {
  contestId Int
  fileId Int
  
  @@id([contestId, fileId])
}